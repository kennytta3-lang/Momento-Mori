<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Mori Widget</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --box-empty: #333;
            --box-filled: #e0e0e0;
            --box-current: #ff5252; /* Red specifically for the 'now' */
            --accent: #4a90e2;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 { font-size: 1.5rem; margin-bottom: 5px; }
        p { font-size: 0.9rem; color: #888; margin-bottom: 20px; }

        /* Controls */
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="date"] {
            padding: 8px;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
        }

        button {
            padding: 8px 16px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover { opacity: 0.9; }

        /* The Grid */
        .life-grid {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            max-width: 800px; /* Adjust for density */
            gap: 4px;
        }

        .week-box {
            width: 8px;
            height: 8px;
            background-color: var(--box-empty);
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .week-box.filled { background-color: var(--box-filled); }
        
        .week-box.current { 
            background-color: var(--box-current); 
            box-shadow: 0 0 5px var(--box-current);
            animation: pulse 2s infinite;
        }

        .stats {
            margin-top: 20px;
            font-size: 0.85rem;
            color: #888;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>MEMENTO MORI</h1>
    <p>Your life in weeks.</p>

    <div class="controls" id="setup-panel">
        <label>Enter Birthdate: </label>
        <input type="date" id="birthdate-input">
        <button onclick="saveDate()">Start Tracking</button>
    </div>

    <div class="controls" id="action-panel" style="display:none;">
        <button onclick="markWeekDone()">Mark This Week Complete</button>
        <button onclick="resetData()" style="background-color: #555; font-size: 0.8rem;">Reset</button>
    </div>

    <div class="life-grid" id="grid"></div>

    <div class="stats" id="stats-display"></div>

    <script>
        const LIFESPAN_YEARS = 80; // Standard Stoic measure
        const TOTAL_WEEKS = LIFESPAN_YEARS * 52;
        const gridContainer = document.getElementById('grid');
        const setupPanel = document.getElementById('setup-panel');
        const actionPanel = document.getElementById('action-panel');
        const statsDisplay = document.getElementById('stats-display');

        // Check for saved data on load
        window.onload = function() {
            const savedDob = localStorage.getItem('memento_dob');
            if (savedDob) {
                renderCalendar(savedDob);
            } else {
                // Initialize empty grid for aesthetics
                renderEmptyGrid();
            }
        };

        function renderEmptyGrid() {
            gridContainer.innerHTML = '';
            for (let i = 0; i < TOTAL_WEEKS; i++) {
                const box = document.createElement('div');
                box.className = 'week-box';
                gridContainer.appendChild(box);
            }
        }

        function saveDate() {
            const dob = document.getElementById('birthdate-input').value;
            if (!dob) return alert("Please enter a valid date.");
            
            localStorage.setItem('memento_dob', dob);
            renderCalendar(dob);
        }

        function resetData() {
            if(confirm("Reset your birthdate?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function renderCalendar(dobString) {
            setupPanel.style.display = 'none';
            actionPanel.style.display = 'flex';
            
            const dob = new Date(dobString);
            const today = new Date();
            
            // Calculate weeks lived
            const oneWeek = 1000 * 60 * 60 * 24 * 7;
            const diffTime = Math.abs(today - dob);
            const weeksLived = Math.floor(diffTime / oneWeek);
            
            // Percentage
            const percentage = ((weeksLived / TOTAL_WEEKS) * 100).toFixed(1);

            gridContainer.innerHTML = '';

            for (let i = 0; i < TOTAL_WEEKS; i++) {
                const box = document.createElement('div');
                box.className = 'week-box';

                if (i < weeksLived) {
                    box.classList.add('filled');
                    box.title = `Week ${i + 1} (Passed)`;
                } else if (i === weeksLived) {
                    box.classList.add('current');
                    box.title = `Current Week`;
                }
                
                gridContainer.appendChild(box);
            }

            statsDisplay.innerHTML = `Lived: ${weeksLived} weeks | Remaining: ${TOTAL_WEEKS - weeksLived} weeks | ${percentage}% Complete`;
        }

        function markWeekDone() {
            // Visual feedback interaction
            alert("Week marked complete. Make the next one count.");
            // In a real app, this would log a specific entry. 
            // Here, it refreshes the calc because 'now' is always moving.
            const savedDob = localStorage.getItem('memento_dob');
            renderCalendar(savedDob);
        }
    </script>
</body>
</html>
