<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Mori Widget</title>
    <style>
        :root {
            --bg-color: #191919; 
            --text-color: #ffffff; /* Changed to White */
            --box-empty: #2f2f2f;
            --box-filled: #e0e0e0;
            --box-current: #ff5252;
            --accent: #4a90e2;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 { 
            font-size: 1.5rem; 
            margin-bottom: 5px; 
            font-weight: 800; /* Bold */
            letter-spacing: 3px; 
            color: #ffffff;
            text-transform: uppercase;
        }

        /* Subtitle (Dates) */
        p { 
            font-size: 0.85rem; 
            color: #ffffff; /* White */
            margin-bottom: 20px; 
            opacity: 0.9;
        }

        /* Controls */
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 0.8rem;
        }

        input[type="date"] {
            padding: 5px;
            background: #2f2f2f;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
            font-family: inherit;
        }

        button {
            padding: 6px 15px;
            background-color: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: bold;
            transition: background 0.2s;
        }

        button:hover { background-color: #444; }
        button.primary { background-color: var(--accent); border-color: var(--accent); }

        /* The Grid */
        .life-grid {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            max-width: 720px; 
            gap: 3px;
            justify-content: flex-start;
        }

        .week-box {
            width: 8px;
            height: 8px;
            background-color: var(--box-empty);
            border-radius: 1px;
        }

        .week-box.filled { background-color: var(--box-filled); }
        
        .week-box.current { 
            background-color: var(--box-current); 
            box-shadow: 0 0 5px var(--box-current);
        }

        /* Bottom Stats */
        .stats {
            margin-top: 25px;
            font-size: 0.85rem;
            color: #ffffff; /* White */
            text-align: center;
            line-height: 1.6;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <h1>Memento Mori</h1>
    <div id="subtitle-container">
        <p>Target: 80 Years</p>
    </div>

    <div class="controls" id="setup-panel">
        <label>Birth Date: </label>
        <input type="date" id="birthdate-input">
        <button class="primary" onclick="saveDate()">Start</button>
    </div>

    <div class="controls" id="action-panel" style="display:none;">
        <button class="primary" onclick="markWeekDone()">Mark Week Done</button>
        <button onclick="resetData()">Reset</button>
    </div>

    <div class="life-grid" id="grid"></div>
    <div class="stats" id="stats-display"></div>

    <script>
        const TARGET_AGE = 80;
        const gridContainer = document.getElementById('grid');
        const setupPanel = document.getElementById('setup-panel');
        const actionPanel = document.getElementById('action-panel');
        const statsDisplay = document.getElementById('stats-display');
        const subtitle = document.getElementById('subtitle-container');

        window.onload = function() {
            const savedDob = localStorage.getItem('memento_dob');
            if (savedDob) {
                renderCalendar(savedDob);
            }
        };

        function saveDate() {
            const dob = document.getElementById('birthdate-input').value;
            if (!dob) return alert("Please enter a valid date.");
            localStorage.setItem('memento_dob', dob);
            renderCalendar(dob);
        }

        function resetData() {
            if(confirm("Reset date?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function renderCalendar(dobString) {
            setupPanel.style.display = 'none';
            actionPanel.style.display = 'flex';
            
            const dob = new Date(dobString + "T00:00:00"); 
            const today = new Date();
            
            const deathDate = new Date(dob);
            deathDate.setFullYear(dob.getFullYear() + TARGET_AGE);

            const oneWeek = 1000 * 60 * 60 * 24 * 7;
            const totalLifeTime = deathDate - dob;
            const timeLived = today - dob;

            const totalWeeks = Math.floor(totalLifeTime / oneWeek);
            const weeksLived = Math.floor(timeLived / oneWeek);
            
            const percentage = ((weeksLived / totalWeeks) * 100).toFixed(2);

            subtitle.innerHTML = `<p>${dob.toDateString()} â€” ${deathDate.toDateString()}</p>`;

            gridContainer.innerHTML = '';
            
            const fragment = document.createDocumentFragment();

            for (let i = 0; i < totalWeeks; i++) {
                const box = document.createElement('div');
                box.className = 'week-box';

                if (i < weeksLived) {
                    box.classList.add('filled');
                } else if (i === weeksLived) {
                    box.classList.add('current');
                }
                
                fragment.appendChild(box);
            }
            gridContainer.appendChild(fragment);

            statsDisplay.innerHTML = `
                ${weeksLived.toLocaleString()} weeks lived<br>
                ${(totalWeeks - weeksLived).toLocaleString()} weeks remaining<br>
                ${percentage}% complete
            `;
        }

        function markWeekDone() {
            alert("Week marked complete.");
            location.reload(); 
        }
    </script>
</body>
</html>
